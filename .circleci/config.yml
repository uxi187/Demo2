version: 2.1
jobs:
  milan:
    working_directory: ~/project
    docker:
     - image: cypress/browsers:chrome69
    steps:
     - run:
        name: Avoid hosts unknown for github
        command: mkdir ~/.ssh/ && echo -e "Host github.com\n\tStrictHostKeyChecking no\n" > ~/.ssh/config
     - run:
        name: Clone GitHub repository
        command: git clone git@github.com:trainsmart/client-frontend-tests.git
     - run:
        name: Ls
        command: dir
     - persist_to_workspace:
         root: ~/project
         paths:
           - .
  run_cypress:
    docker:
     - image: cypress/browsers:chrome69
    parallelism: 1
    steps:
     - attach_workspace:
        at: ~/project
     - run:
        name: Directory
        command: dir
     - run:
        name: Directory under demo
        command: cd client-frontend-tests && dir
     - run:
        name: Install dependencies 
        command: npm ci
        working_directory: '~/project/client-frontend-tests'
     - run:
        name: Verify Cypress
        command: npx cypress verify
        working_directory: '~/project/client-frontend-tests'
     - run:
        command: npm run spec_test:nav
        working_directory: '~/project/client-frontend-tests'
workflows:
  build:
    jobs:
      - milan
      - run_cypress:
          requires:
            - milan
     